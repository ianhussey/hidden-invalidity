---
title: "Hidden invalidity among fifteen commonly used measures in social and personality psychology"
subtitle: "Supplementary materials"
author: "Ian Hussey^[Ghent University. Email: ian.hussey@ugent.be]"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r, include=FALSE}
knitr::opts_chunk$set(message=FALSE,
                      warning=FALSE)
```

# Data

## Get data

```{r}

library(tidyverse)
library(effsize)
library(lubridate)
library(knitr)
library(kableExtra)
library(semTools)
library(timesavers)
library(plotrix)
library(patchwork)

# get data
load("../data/trimmed_data.RData")

# trim to include only the first timepoint per user_id per scale
# ie exclude repeat participations on the same scale
trimmed_first_timepoint_per_user_per_scale <- trimmed_data %>%
  arrange(user_id, individual_differences_measure, datetime_ymdhms) %>%
  mutate(combined_var = paste0(user_id, individual_differences_measure)) %>%
  filter(combined_var != lag(combined_var)) %>%
  dplyr::select(-combined_var) 

```

## Subset data

```{r}

# find median age to split by.
# Because individuals can participate more than once, and their age is recorded as age at participation, repeat participations
# overrepresent that participant's age when finding medians. Given we can't assume that repeate participations are evenly distributed across ages, # we must instead construct a median age for the whole sample. 
# This also ensures that the same median age is used for all scales.

median_age <- trimmed_first_timepoint_per_user_per_scale %>%
  group_by(user_id) %>%
  summarize(mean_age_by_participant = mean(age)) %>%  # given repeat presentations with changing age
  ungroup() %>%
  summarize(median_age = median(mean_age_by_participant)) %>%
  pull(median_age) %>%
  round(0)

# split scales

bfi_e_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(bfi_e1, bfi_e2, bfi_e3, bfi_e4, bfi_e5, bfi_e6, bfi_e7, bfi_e8, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

bfi_c_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(bfi_c1, bfi_c2, bfi_c3, bfi_c4, bfi_c5, bfi_c6, bfi_c7, bfi_c8, bfi_c9, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

bfi_n_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(bfi_n1, bfi_n2, bfi_n3, bfi_n4, bfi_n5, bfi_n6, bfi_n7, bfi_n8, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

bfi_a_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(bfi_a1, bfi_a2, bfi_a3, bfi_a4, bfi_a5, bfi_a6, bfi_a7, bfi_a8, bfi_a9, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

bfi_o_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(bfi_o1, bfi_o2, bfi_o3, bfi_o4, bfi_o5, bfi_o6, bfi_o7, bfi_o8, bfi_o9, bfi_o10, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

bidr_im_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(bidr_im1, bidr_im2, bidr_im3, bidr_im4, bidr_im5, bidr_im6, bidr_im7, bidr_im8, 
                bidr_im9, bidr_im10, bidr_im11, bidr_im12, bidr_im13, bidr_im14, bidr_im15, 
                bidr_im16, bidr_im17, bidr_im18, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

bidr_sde_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(bidr_sde1, bidr_sde2, bidr_sde3, bidr_sde4, bidr_sde5, bidr_sde6, bidr_sde7, bidr_sde8, 
                bidr_sde9, bidr_sde10, bidr_sde11, bidr_sde12, bidr_sde13, bidr_sde14, bidr_sde15, bidr_sde16, 
                bidr_sde17, bidr_sde18, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

bjw_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(bjw1, bjw2, bjw3, bjw4, bjw5, bjw6, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

brs_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(brs1, brs2, brs3, brs4, brs5, brs6, brs7, brs8, brs9, brs10, 
                brs11, brs12, brs13, brs14, brs15, brs16, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

he_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(he1, he2, he3, he4, he5, he6, he7, he8, he9, he10, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

icat_o_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(icat_o1, icat_o2, icat_o3, icat_o4, icat_o5, icat_o6, icat_o7, icat_o8, icat_o9, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

icat_s_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(icat_s1, icat_s2, icat_s3, icat_s4, icat_s5, icat_s6, icat_s7, icat_s8, icat_s9, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

nfc_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(nfc1, nfc2, nfc3, nfc4, nfc5, nfc6, nfc7, nfc8, nfc9, 
                nfc10, nfc11, nfc12, nfc13, nfc14, nfc15, nfc16, nfc17, nfc18, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

nfcc_p_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(nfcc_p1, nfcc_p2, nfcc_p3, nfcc_p4, nfcc_p5, nfcc_p6, nfcc_p7, nfcc_p8, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

nfcc_d_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(nfcc_d1, nfcc_d2, nfcc_d3, nfcc_d4, nfcc_d5, nfcc_d6, nfcc_d7, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

nfcc_c_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(nfcc_c1, nfcc_c2, nfcc_c3, nfcc_c4, nfcc_c5, nfcc_c6, nfcc_c7, nfcc_c8, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

nfcc_a_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(nfcc_a1, nfcc_a2, nfcc_a3, nfcc_a4, nfcc_a5, nfcc_a6, nfcc_a7, nfcc_a8, nfcc_a9, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

nfcc_o_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(nfcc_o1, nfcc_o2, nfcc_o3, nfcc_o4, nfcc_o5, 
                nfcc_o6, nfcc_o7, nfcc_o8, nfcc_o9, nfcc_o10, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

pe_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(pe1, pe2, pe3, pe4, pe5, pe6, pe7, pe8, pe9, pe10, pe11, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

pns_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(pns1, pns2, pns3, pns4, pns5, pns6, pns7, pns8, pns9, pns10, pns11, pns12, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

rse_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(rse1, rse2, rse3, rse4, rse5, rse6, rse7, rse8, rse9, rse10, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

rwa_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(rwa1, rwa2, rwa3, rwa4, rwa5, rwa6, rwa7, rwa8, rwa9, rwa10, 
                rwa11, rwa12, rwa13, rwa14, rwa15, rwa16, rwa17, rwa18, rwa19, rwa20, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

sdo_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(sdo1, sdo2, sdo3, sdo4, sdo5, sdo6, sdo7, sdo8, sdo9, sdo10, sdo11, sdo12, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

sm_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(sm1, sm2, sm3, sm4, sm5, sm6, sm7, sm8, sm9, 
                sm10, sm11, sm12, sm13, sm14, sm15, sm16, sm17, sm18, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

soc_ic_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(soc_ic1, soc_ic2, soc_ic3, soc_ic4, soc_ic5, 
                soc_ic6, soc_ic7, soc_ic8, soc_ic9, soc_ic10, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

soc_pe_data <- trimmed_first_timepoint_per_user_per_scale %>%
  dplyr::select(soc_pe1, soc_pe2, soc_pe3, soc_pe4, soc_pe5, soc_pe6, soc_pe7, soc_pe8, soc_pe9, soc_pe10, sex, age) %>%
  na.omit() %>%
  mutate(age = ifelse(age < median_age, 0, 1))

```

## Models

```{r}

bfi_e_model <- "E =~ bfi_e1 + bfi_e2 + bfi_e3 + bfi_e4 + bfi_e5 + bfi_e6 + bfi_e7 + bfi_e8" 

bfi_c_model <- "C =~ bfi_c1 + bfi_c2 + bfi_c3 + bfi_c4 + bfi_c5 + bfi_c6 + bfi_c7 + bfi_c8 + bfi_c9" 

bfi_n_model <- "N =~ bfi_n1 + bfi_n2 + bfi_n3 + bfi_n4 + bfi_n5 + bfi_n6 + bfi_n7 + bfi_n8" 

bfi_a_model <- "A =~ bfi_a1 + bfi_a2 + bfi_a3 + bfi_a4 + bfi_a5 + bfi_a6 + bfi_a7 + bfi_a8 + bfi_a9" 

bfi_o_model <- "O =~ bfi_o1 + bfi_o2 + bfi_o3 + bfi_o4 + bfi_o5 + bfi_o6 + bfi_o7 + bfi_o8 + bfi_o9 + bfi_o10" 

bidr_im_model <- "IM =~ bidr_im1 + bidr_im2 + bidr_im3 + bidr_im4 + bidr_im5 + bidr_im6 + bidr_im7 + 
                        bidr_im8 + bidr_im9 + bidr_im10 + bidr_im11 + bidr_im12 + bidr_im13 + bidr_im14 + 
                        bidr_im15 + bidr_im16 + bidr_im17 + bidr_im18" 

bidr_sde_model <- "SDE =~ bidr_sde1 + bidr_sde2 + bidr_sde3 + bidr_sde4 + bidr_sde5 + bidr_sde6 + bidr_sde7 +
                          bidr_sde8 + bidr_sde9 + bidr_sde10 + bidr_sde11 + bidr_sde12 + bidr_sde13 + 
                          bidr_sde14 + bidr_sde15 + bidr_sde16 + bidr_sde17 + bidr_sde18" 

bjw_model <- "BJW =~ bjw1 + bjw2 + bjw3 + bjw4 + bjw5 + bjw6" 

brs_model <- "BRS =~ brs1 + brs2 + brs3 + brs4 + brs5 + brs6 + brs7 + brs8 + 
                     brs9 + brs10 + brs11 + brs12 + brs13 + brs14 + brs15 + brs16" 

he_model <- "HE =~ he1 + he2 + he3 + he4 + he5 + he6 + he7 + he8 + he9 + he10" 

icat_o_model <- "ICAT_O =~ icat_o1 + icat_o2 + icat_o3 + icat_o4 + icat_o5 + icat_o6 + icat_o7 + icat_o8 + icat_o9" 

icat_s_model <- "ICAT_S =~ icat_s1 + icat_s2 + icat_s3 + icat_s4 + icat_s5 + icat_s6 + icat_s7 + icat_s8 + icat_s9" 

nfc_model <- "NFC =~ nfc1 + nfc2 + nfc3 + nfc4 + nfc5 + nfc6 + nfc7 + nfc8 + nfc9 + 
                     nfc10 + nfc11 + nfc12 + nfc13 + nfc14 + nfc15 + nfc16 + nfc17 + nfc18" 

nfcc_p_model <- "P =~ nfcc_p1 + nfcc_p2 + nfcc_p3 + nfcc_p4 + nfcc_p5 + nfcc_p6 + nfcc_p7 + nfcc_p8" 

nfcc_d_model <- "D =~ nfcc_d1 + nfcc_d2 + nfcc_d3 + nfcc_d4 + nfcc_d5 + nfcc_d6 + nfcc_d7" 

nfcc_c_model <- "C =~ nfcc_c1 + nfcc_c2 + nfcc_c3 + nfcc_c4 + nfcc_c5 + nfcc_c6 + nfcc_c7 + nfcc_c8" 

nfcc_a_model <- "A =~ nfcc_a1 + nfcc_a2 + nfcc_a3 + nfcc_a4 + nfcc_a5 + 
                      nfcc_a6 + nfcc_a7 + nfcc_a8 + nfcc_a9"

nfcc_o_model <- "O =~ nfcc_o1 + nfcc_o2 + nfcc_o3 + nfcc_o4 + nfcc_o5 +
                      nfcc_o6 + nfcc_o7 + nfcc_o8 + nfcc_o9 + nfcc_o10" 

pe_model <- "PE =~ pe1 + pe2 + pe3 + pe4 + pe5 + pe6 + pe7 + pe8 + pe9 + pe10 + pe11" 

pns_model <- "PNS =~ pns1 + pns2 + pns3 + pns4 + pns5 + pns6 + pns7 + pns8 + pns9 + pns10 + pns11 + pns12" 

rse_model <- "RSE =~ rse1 + rse2 + rse3 + rse4 + rse5 + rse6 + rse7 + rse8 + rse9 + rse10" 

rwa_model <- "RWA =~ rwa1 + rwa2 + rwa3 + rwa4 + rwa5 + rwa6 + rwa7 + rwa8 + rwa9 + rwa10 + 
                     rwa11 + rwa12 + rwa13 + rwa14 + rwa15 + rwa16 + rwa17 + rwa18 + rwa19 + rwa20" 

sdo_model <- "SDO =~ sdo1 + sdo2 + sdo3 + sdo4 + sdo5 + sdo6 + sdo7 + sdo8 + sdo9 + sdo10 + sdo11 + sdo12" 

sm_model <- "SM =~ sm1 + sm2 + sm3 + sm4 + sm5 + sm6 + sm7 + sm8 + sm9 + 
                   sm10 + sm11 + sm12 + sm13 + sm14 + sm15 + sm16 + sm17 + sm18" 

soc_ic_model <- "IC =~ soc_ic1 + soc_ic2 + soc_ic3 + soc_ic4 + soc_ic5 + 
                       soc_ic6 + soc_ic7 + soc_ic8 + soc_ic9 + soc_ic10" 

soc_pe_model <- "PE =~ soc_pe1 + soc_pe2 + soc_pe3 + soc_pe4 + soc_pe5 + 
                       soc_pe6 + soc_pe7 + soc_pe8 + soc_pe9 + soc_pe10" 

```

# Effect size for CFA fit

```{r}

## fit a CFA and return its model fit statistics
cfa_fit <- function(data, model) {
  require(lavaan)
  require(tidyverse)
  
  # fit cfa
  cfa_data <- data %>%
    dplyr::select(-sex, -age)
  
  # sem model
  fit <- cfa(model, 
             data = cfa_data, 
             order = c("1", "2", "3", "4", "5", "6"),
             estimator = "WLSMV") 
  
  return(fit)
}

```

```{r}

# fit models
bfi_e_fit    <- cfa_fit(data = bfi_e_data,    model = bfi_e_model)
bfi_c_fit    <- cfa_fit(data = bfi_c_data,    model = bfi_c_model)
bfi_n_fit    <- cfa_fit(data = bfi_n_data,    model = bfi_n_model)
bfi_a_fit    <- cfa_fit(data = bfi_a_data,    model = bfi_a_model)
bfi_o_fit    <- cfa_fit(data = bfi_o_data,    model = bfi_o_model)
bidr_im_fit  <- cfa_fit(data = bidr_im_data,  model = bidr_im_model)
bidr_sde_fit <- cfa_fit(data = bidr_sde_data, model = bidr_sde_model)
bjw_fit      <- cfa_fit(data = bjw_data,      model = bjw_model)
brs_fit      <- cfa_fit(data = brs_data,      model = brs_model)
he_fit       <- cfa_fit(data = he_data,       model = he_model)
icat_o_fit   <- cfa_fit(data = icat_o_data,   model = icat_o_model)
icat_s_fit   <- cfa_fit(data = icat_s_data,   model = icat_s_model)
nfc_fit      <- cfa_fit(data = nfc_data,      model = nfc_model)
nfcc_p_fit   <- cfa_fit(data = nfcc_p_data,   model = nfcc_p_model)
nfcc_d_fit   <- cfa_fit(data = nfcc_d_data,   model = nfcc_d_model)
nfcc_c_fit   <- cfa_fit(data = nfcc_c_data,   model = nfcc_c_model)
nfcc_a_fit   <- cfa_fit(data = nfcc_a_data,   model = nfcc_a_model)
nfcc_o_fit   <- cfa_fit(data = nfcc_o_data,   model = nfcc_o_model)
pe_fit       <- cfa_fit(data = pe_data,       model = pe_model)
pns_fit      <- cfa_fit(data = pns_data,      model = pns_model)
rse_fit      <- cfa_fit(data = rse_data,      model = rse_model)
rwa_fit      <- cfa_fit(data = rwa_data,      model = rwa_model)
sdo_fit      <- cfa_fit(data = sdo_data,      model = sdo_model)
sm_fit       <- cfa_fit(data = sm_data,       model = sm_model)
soc_ic_fit   <- cfa_fit(data = soc_ic_data,   model = soc_ic_model)
soc_pe_fit   <- cfa_fit(data = soc_pe_data,   model = soc_pe_model)


# calculate latent and observed sum scores
latent_observed_bfi_e <- bfi_e_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_e_fit))$E) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_e1, bfi_e2, bfi_e3, bfi_e4, bfi_e5, bfi_e6, bfi_e7, bfi_e8))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_bfi_c <- bfi_c_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_c_fit))$C) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_c1, bfi_c2, bfi_c3, bfi_c4, bfi_c5, bfi_c6, bfi_c7, bfi_c8, bfi_c9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_bfi_n <- bfi_n_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_n_fit))$N) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_n1, bfi_n2, bfi_n3, bfi_n4, bfi_n5, bfi_n6, bfi_n7, bfi_n8))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_bfi_a <- bfi_a_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_a_fit))$A) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_a1, bfi_a2, bfi_a3, bfi_a4, bfi_a5, bfi_a6, bfi_a7, bfi_a8, bfi_a9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_bfi_o <- bfi_o_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_o_fit))$O) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_o1, bfi_o2, bfi_o3, bfi_o4, bfi_o5, bfi_o6, bfi_o7, bfi_o8, bfi_o9, bfi_o10))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_bidr_im <- bidr_im_data %>%
  mutate(latent = as.data.frame(lavPredict(bidr_im_fit))$IM) %>%
  rowwise() %>%
  mutate(observed = mean(c(bidr_im1, bidr_im2, bidr_im3, bidr_im4, bidr_im5, bidr_im6, bidr_im7, bidr_im8, bidr_im9, bidr_im10, bidr_im11, bidr_im12, bidr_im13, bidr_im14, bidr_im15, bidr_im16, bidr_im17, bidr_im18))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_bidr_sde <- bidr_sde_data %>%
  mutate(latent = as.data.frame(lavPredict(bidr_sde_fit))$SDE) %>%
  rowwise() %>%
  mutate(observed = mean(c(bidr_sde1, bidr_sde2, bidr_sde3, bidr_sde4, bidr_sde5, bidr_sde6, bidr_sde7, bidr_sde8, bidr_sde9, bidr_sde10, bidr_sde11, bidr_sde12, bidr_sde13, bidr_sde14, bidr_sde15, bidr_sde16, bidr_sde17, bidr_sde18))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_bjw <- bjw_data %>%
  mutate(latent = as.data.frame(lavPredict(bjw_fit))$BJW) %>%
  rowwise() %>%
  mutate(observed = mean(c(bjw1, bjw2, bjw3, bjw4, bjw5, bjw6))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_brs <- brs_data %>%
  mutate(latent = as.data.frame(lavPredict(brs_fit))$BRS) %>%
  rowwise() %>%
  mutate(observed = mean(c(brs1, brs2, brs3, brs4, brs5, brs6, brs7, brs8, brs9, brs10, brs11, brs12, brs13, brs14, brs15, brs16))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_he <- he_data %>%
  mutate(latent = as.data.frame(lavPredict(he_fit))$HE) %>%
  rowwise() %>%
  mutate(observed = mean(c(he1, he2, he3, he4, he5, he6, he7, he8, he9, he10))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_icat_o <- icat_o_data %>%
  mutate(latent = as.data.frame(lavPredict(icat_o_fit))$ICAT_O) %>%
  rowwise() %>%
  mutate(observed = mean(c(icat_o1, icat_o2, icat_o3, icat_o4, icat_o5, icat_o6, icat_o7, icat_o8, icat_o9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_icat_s <- icat_s_data %>%
  mutate(latent = as.data.frame(lavPredict(icat_s_fit))$ICAT_S) %>%
  rowwise() %>%
  mutate(observed = mean(c(icat_s1, icat_s2, icat_s3, icat_s4, icat_s5, icat_s6, icat_s7, icat_s8, icat_s9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_nfc <- nfc_data %>%
  mutate(latent = as.data.frame(lavPredict(nfc_fit))$NFC) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfc1, nfc2, nfc3, nfc4, nfc5, nfc6, nfc7, nfc8, nfc9, nfc10, nfc11, nfc12, nfc13, nfc14, nfc15, nfc16, nfc17, nfc18))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_nfcc_p <- nfcc_p_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_p_fit))$P) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_p1, nfcc_p2, nfcc_p3, nfcc_p4, nfcc_p5, nfcc_p6, nfcc_p7, nfcc_p8))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_nfcc_d <- nfcc_d_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_d_fit))$D) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_d1, nfcc_d2, nfcc_d3, nfcc_d4, nfcc_d5, nfcc_d6, nfcc_d7))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_nfcc_c <- nfcc_c_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_c_fit))$C) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_c1, nfcc_c2, nfcc_c3, nfcc_c4, nfcc_c5, nfcc_c6, nfcc_c7, nfcc_c8))) %>%
  ungroup() %>%
  select(age, sex, latent, observed)

latent_observed_nfcc_a <- nfcc_a_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_a_fit))$A) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_a1, nfcc_a2, nfcc_a3, nfcc_a4, nfcc_a5, nfcc_a6, nfcc_a7, nfcc_a8))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_nfcc_o <- nfcc_o_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_o_fit))$O) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_o1, nfcc_o2, nfcc_o3, nfcc_o4, nfcc_o5, nfcc_o6, nfcc_o7))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_pe <- pe_data %>%
  mutate(latent = as.data.frame(lavPredict(pe_fit))$PE) %>%
  rowwise() %>%
  mutate(observed = mean(c(pe1, pe2, pe3, pe4, pe5, pe6, pe7, pe8, pe9, pe10, pe11))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_pns <- pns_data %>%
  mutate(latent = as.data.frame(lavPredict(pns_fit))$PNS) %>%
  rowwise() %>%
  mutate(observed = mean(c(pns1, pns2, pns3, pns4, pns5, pns6, pns7, pns8, pns9, pns10, pns11, pns12))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_rse <- rse_data %>%
  mutate(latent = as.data.frame(lavPredict(rse_fit))$RSE) %>%
  rowwise() %>%
  mutate(observed = mean(c(rse1, rse2, rse3, rse4, rse5, rse6, rse7, rse8, rse9, rse10))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_rwa <- rwa_data %>%
  mutate(latent = as.data.frame(lavPredict(rwa_fit))$RWA) %>%
  rowwise() %>%
  mutate(observed = mean(c(rwa1, rwa2, rwa3, rwa4, rwa5, rwa6, rwa7, rwa8, rwa9, rwa10, rwa11, rwa12, rwa13, rwa14, rwa15, rwa16, rwa17, rwa18, rwa19, rwa20))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_sdo <- sdo_data %>%
  mutate(latent = as.data.frame(lavPredict(sdo_fit))$SDO) %>%
  rowwise() %>%
  mutate(observed = mean(c(sdo1, sdo2, sdo3, sdo4, sdo5, sdo6, sdo7, sdo8, sdo9, sdo10, sdo11, sdo12))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_sm <- sm_data %>%
  mutate(latent = as.data.frame(lavPredict(sm_fit))$SM) %>%
  rowwise() %>%
  mutate(observed = mean(c(sm1, sm2, sm3, sm4, sm5, sm6, sm7, sm8, sm9, sm10, sm11, sm12, sm13, sm14, sm15, sm16, sm17, sm18))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_soc_ic <- soc_ic_data %>%
  mutate(latent = as.data.frame(lavPredict(soc_ic_fit))$IC) %>%
  rowwise() %>%
  mutate(observed = mean(c(soc_ic1, soc_ic2, soc_ic3, soc_ic4, soc_ic5, soc_ic6, soc_ic7, soc_ic8, soc_ic9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

latent_observed_soc_pe <- soc_pe_data %>%
  mutate(latent = as.data.frame(lavPredict(soc_pe_fit))$PE) %>%
  rowwise() %>%
  mutate(observed = mean(c(soc_pe1, soc_pe2, soc_pe3, soc_pe4, soc_pe5, soc_pe6, soc_pe7, soc_pe8, soc_pe9, soc_pe10))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

```

## Correlations between latent and observed scores, and misclassification rate between them

Cut points for classifications are of course arbitrary and hard to know what researchers might use. For illustration, we use the mean of the scale (i.e., 0 on the scaled and centered variable) to show the rate of incongruent conclusions when using the observed sum score vs. the latent mean for decision making.

```{r}

percent_misclassification <- function(data) {
  data %>%
    mutate(latent_std = as.numeric(scale(latent)),
           observed_std = as.numeric(scale(observed)),
           congruent_classification = ifelse(latent_std*observed_std > 0, TRUE, FALSE)) %>%
    filter(congruent_classification == FALSE) %>%
    summarize(percent = (n()/nrow(data))*100) %>%
    pull(percent)
}

latent_observed_correlation_results <- 
  data.frame(scale_name = c("bfi_a", "bfi_c", "bfi_e", "bfi_n", "bfi_o", "bidr_im", "bidr_sde", "bjw", "brs", 
                            "he", "icat_o", "icat_s", "nfc", "nfcc_a", "nfcc_c", "nfcc_d", "nfcc_o", "nfcc_p", 
                            "pe", "pns", "rse", "rwa", "sdo", "sm", "soc_ic", "soc_pe"),
             r = c(cor.test(latent_observed_bfi_a$latent, latent_observed_bfi_a$observed)$estimate,
                   cor.test(latent_observed_bfi_c$latent, latent_observed_bfi_c$observed)$estimate,
                   cor.test(latent_observed_bfi_e$latent, latent_observed_bfi_e$observed)$estimate,
                   cor.test(latent_observed_bfi_n$latent, latent_observed_bfi_n$observed)$estimate,
                   cor.test(latent_observed_bfi_o$latent, latent_observed_bfi_o$observed)$estimate,
                   cor.test(latent_observed_bidr_im$latent, latent_observed_bidr_im$observed)$estimate,
                   cor.test(latent_observed_bidr_sde$latent, latent_observed_bidr_sde$observed)$estimate,
                   cor.test(latent_observed_bjw$latent, latent_observed_bjw$observed)$estimate,
                   cor.test(latent_observed_brs$latent, latent_observed_brs$observed)$estimate,
                   cor.test(latent_observed_he$latent, latent_observed_he$observed)$estimate,
                   cor.test(latent_observed_icat_o$latent, latent_observed_icat_o$observed)$estimate,
                   cor.test(latent_observed_icat_s$latent, latent_observed_icat_s$observed)$estimate,
                   cor.test(latent_observed_nfc$latent, latent_observed_nfc$observed)$estimate,
                   cor.test(latent_observed_nfcc_p$latent, latent_observed_nfcc_p$observed)$estimate,
                   cor.test(latent_observed_nfcc_d$latent, latent_observed_nfcc_d$observed)$estimate,
                   cor.test(latent_observed_nfcc_c$latent, latent_observed_nfcc_c$observed)$estimate,
                   cor.test(latent_observed_nfcc_a$latent, latent_observed_nfcc_a$observed)$estimate,
                   cor.test(latent_observed_nfcc_o$latent, latent_observed_nfcc_o$observed)$estimate,
                   cor.test(latent_observed_pe$latent, latent_observed_pe$observed)$estimate,
                   cor.test(latent_observed_pns$latent, latent_observed_pns$observed)$estimate,
                   cor.test(latent_observed_rse$latent, latent_observed_rse$observed)$estimate,
                   cor.test(latent_observed_rwa$latent, latent_observed_rwa$observed)$estimate,
                   cor.test(latent_observed_sdo$latent, latent_observed_sdo$observed)$estimate,
                   cor.test(latent_observed_sm$latent, latent_observed_sm$observed)$estimate,
                   cor.test(latent_observed_soc_ic$latent, latent_observed_soc_ic$observed)$estimate,
                   cor.test(latent_observed_soc_pe$latent, latent_observed_soc_pe$observed)$estimate),
             r_ci_lwr = c(cor.test(latent_observed_bfi_a$latent, latent_observed_bfi_a$observed)$conf.int[1],
                          cor.test(latent_observed_bfi_c$latent, latent_observed_bfi_c$observed)$conf.int[1],
                          cor.test(latent_observed_bfi_e$latent, latent_observed_bfi_e$observed)$conf.int[1],
                          cor.test(latent_observed_bfi_n$latent, latent_observed_bfi_n$observed)$conf.int[1],
                          cor.test(latent_observed_bfi_o$latent, latent_observed_bfi_o$observed)$conf.int[1],
                          cor.test(latent_observed_bidr_im$latent, latent_observed_bidr_im$observed)$conf.int[1],
                          cor.test(latent_observed_bidr_sde$latent, latent_observed_bidr_sde$observed)$conf.int[1],
                          cor.test(latent_observed_bjw$latent, latent_observed_bjw$observed)$conf.int[1],
                          cor.test(latent_observed_brs$latent, latent_observed_brs$observed)$conf.int[1],
                          cor.test(latent_observed_he$latent, latent_observed_he$observed)$conf.int[1],
                          cor.test(latent_observed_icat_o$latent, latent_observed_icat_o$observed)$conf.int[1],
                          cor.test(latent_observed_icat_s$latent, latent_observed_icat_s$observed)$conf.int[1],
                          cor.test(latent_observed_nfc$latent, latent_observed_nfc$observed)$conf.int[1],
                          cor.test(latent_observed_nfcc_p$latent, latent_observed_nfcc_p$observed)$conf.int[1],
                          cor.test(latent_observed_nfcc_d$latent, latent_observed_nfcc_d$observed)$conf.int[1],
                          cor.test(latent_observed_nfcc_c$latent, latent_observed_nfcc_c$observed)$conf.int[1],
                          cor.test(latent_observed_nfcc_a$latent, latent_observed_nfcc_a$observed)$conf.int[1],
                          cor.test(latent_observed_nfcc_o$latent, latent_observed_nfcc_o$observed)$conf.int[1],
                          cor.test(latent_observed_pe$latent, latent_observed_pe$observed)$conf.int[1],
                          cor.test(latent_observed_pns$latent, latent_observed_pns$observed)$conf.int[1],
                          cor.test(latent_observed_rse$latent, latent_observed_rse$observed)$conf.int[1],
                          cor.test(latent_observed_rwa$latent, latent_observed_rwa$observed)$conf.int[1],
                          cor.test(latent_observed_sdo$latent, latent_observed_sdo$observed)$conf.int[1],
                          cor.test(latent_observed_sm$latent, latent_observed_sm$observed)$conf.int[1],
                          cor.test(latent_observed_soc_ic$latent, latent_observed_soc_ic$observed)$conf.int[1],
                          cor.test(latent_observed_soc_pe$latent, latent_observed_soc_pe$observed)$conf.int[1]),
             r_ci_upr = c(cor.test(latent_observed_bfi_a$latent, latent_observed_bfi_a$observed)$conf.int[2],
                          cor.test(latent_observed_bfi_c$latent, latent_observed_bfi_c$observed)$conf.int[2],
                          cor.test(latent_observed_bfi_e$latent, latent_observed_bfi_e$observed)$conf.int[2],
                          cor.test(latent_observed_bfi_n$latent, latent_observed_bfi_n$observed)$conf.int[2],
                          cor.test(latent_observed_bfi_o$latent, latent_observed_bfi_o$observed)$conf.int[2],
                          cor.test(latent_observed_bidr_im$latent, latent_observed_bidr_im$observed)$conf.int[2],
                          cor.test(latent_observed_bidr_sde$latent, latent_observed_bidr_sde$observed)$conf.int[2],
                          cor.test(latent_observed_bjw$latent, latent_observed_bjw$observed)$conf.int[2],
                          cor.test(latent_observed_brs$latent, latent_observed_brs$observed)$conf.int[2],
                          cor.test(latent_observed_he$latent, latent_observed_he$observed)$conf.int[2],
                          cor.test(latent_observed_icat_o$latent, latent_observed_icat_o$observed)$conf.int[2],
                          cor.test(latent_observed_icat_s$latent, latent_observed_icat_s$observed)$conf.int[2],
                          cor.test(latent_observed_nfc$latent, latent_observed_nfc$observed)$conf.int[2],
                          cor.test(latent_observed_nfcc_p$latent, latent_observed_nfcc_p$observed)$conf.int[2],
                          cor.test(latent_observed_nfcc_d$latent, latent_observed_nfcc_d$observed)$conf.int[2],
                          cor.test(latent_observed_nfcc_c$latent, latent_observed_nfcc_c$observed)$conf.int[2],
                          cor.test(latent_observed_nfcc_a$latent, latent_observed_nfcc_a$observed)$conf.int[2],
                          cor.test(latent_observed_nfcc_o$latent, latent_observed_nfcc_o$observed)$conf.int[2],
                          cor.test(latent_observed_pe$latent, latent_observed_pe$observed)$conf.int[2],
                          cor.test(latent_observed_pns$latent, latent_observed_pns$observed)$conf.int[2],
                          cor.test(latent_observed_rse$latent, latent_observed_rse$observed)$conf.int[2],
                          cor.test(latent_observed_rwa$latent, latent_observed_rwa$observed)$conf.int[2],
                          cor.test(latent_observed_sdo$latent, latent_observed_sdo$observed)$conf.int[2],
                          cor.test(latent_observed_sm$latent, latent_observed_sm$observed)$conf.int[2],
                          cor.test(latent_observed_soc_ic$latent, latent_observed_soc_ic$observed)$conf.int[2],
                          cor.test(latent_observed_soc_pe$latent, latent_observed_soc_pe$observed)$conf.int[2]),
             percent_misclassification = c(percent_misclassification(latent_observed_bfi_a),
                                        percent_misclassification(latent_observed_bfi_c),
                                        percent_misclassification(latent_observed_bfi_e),
                                        percent_misclassification(latent_observed_bfi_n),
                                        percent_misclassification(latent_observed_bfi_o),
                                        percent_misclassification(latent_observed_bidr_im),
                                        percent_misclassification(latent_observed_bidr_sde),
                                        percent_misclassification(latent_observed_bjw),
                                        percent_misclassification(latent_observed_brs),
                                        percent_misclassification(latent_observed_he),
                                        percent_misclassification(latent_observed_icat_o),
                                        percent_misclassification(latent_observed_icat_s),
                                        percent_misclassification(latent_observed_nfc),
                                        percent_misclassification(latent_observed_nfcc_p),
                                        percent_misclassification(latent_observed_nfcc_d),
                                        percent_misclassification(latent_observed_nfcc_c),
                                        percent_misclassification(latent_observed_nfcc_a),
                                        percent_misclassification(latent_observed_nfcc_o),
                                        percent_misclassification(latent_observed_pe),
                                        percent_misclassification(latent_observed_pns),
                                        percent_misclassification(latent_observed_rse),
                                        percent_misclassification(latent_observed_rwa),
                                        percent_misclassification(latent_observed_sdo),
                                        percent_misclassification(latent_observed_sm),
                                        percent_misclassification(latent_observed_soc_ic),
                                        percent_misclassification(latent_observed_soc_pe))) %>%
  round_df(3) %>%
  mutate(Scale = dplyr::recode(scale_name,
                               "bfi_e"    = "Big 5 Inventory - E",
                               "bfi_c"    = "Big 5 Inventory - C",
                               "bfi_n"    = "Big 5 Inventory - N",
                               "bfi_a"    = "Big 5 Inventory - A",
                               "bfi_o"    = "Big 5 Inventory - O",
                               "bidr_im"  = "Balanced Inventory of Desirable Responding - Impression Management",
                               "bidr_sde" = "Balanced Inventory of Desirable Responding - Self Deception",
                               "bjw"      = "Belief in a Just World: General Just World Scale",
                               "brs"      = "Bayesian Racism",
                               "he"       = "Humanitarianism-Egalitarianism",
                               "icat_o"   = "Intuitions about Controllability and Awareness of Thoughts - Others",
                               "icat_s"   = "Intuitions about Controllability and Awareness of Thoughts - Self",
                               "nfc"      = "Need for Cognition",
                               "nfcc_p"   = "Need for Cognitive Closure - P",
                               "nfcc_d"   = "Need for Cognitive Closure - D",
                               "nfcc_c"   = "Need for Cognitive Closure - C",
                               "nfcc_a"   = "Need for Cognitive Closure - A",
                               "nfcc_o"   = "Need for Cognitive Closure - O",
                               "pe"       = "Protestant Ethic",
                               "pns"      = "Personal Need for Structure",
                               "rse"      = "Rosenberg Self-Esteem",
                               "rwa"      = "Ring-Wing Authoritarianism",
                               "sdo"      = "Social Dominance Orientation",
                               "sm"       = "Self-Monitoring",
                               "soc_ic"   = "Spheres of Control - Interpersonal Control",
                               "soc_pe"   = "Spheres of Control - Personal Efficacy")) %>%
  arrange(Scale) %>%
  select(Scale, r, r_ci_lwr, r_ci_upr, percent_misclassification) %>%
  mutate(percent_misclassification = round(percent_misclassification, 1))

# write to disk
write_csv(latent_observed_correlation_results, "results/supplementary_results_effect_sizes_cfa_fits.csv")

# table
latent_observed_correlation_results %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

# plots
ggplot(latent_observed_correlation_results, aes(r, fill = "dummy")) +
  geom_density(alpha = 0.7) +
  scale_fill_viridis_d(begin = 0.7, end = 0.7) + 
  theme(legend.position = "none") +
  xlab("correlation between latent and observed scores")

ggplot(latent_observed_correlation_results, aes(percent_misclassification, fill = "dummy")) +
  geom_density(alpha = 0.7) +
  scale_fill_viridis_d(begin = 0.7, end = 0.7) + 
  theme(legend.position = "none") +
  xlab("percent of incongruent group classifications between the latent and observed sum scores\nusing the mean as an illustrative cutpoint")

```

# Effect size for measurement invariance

```{r}

## fit a CFA and return its model fit statistics
constrained_cfa_fit <- function(data, model) {
  require(lavaan)
  require(tidyverse)
  
  # fit cfa
  cfa_data <- data %>%
    dplyr::select(-sex, -age)
  
  # sem model
  fit <- cfa(model, 
             data = cfa_data, 
             order = c("1", "2", "3", "4", "5", "6"),
             estimator = "WLSMV",
             group.equal = c("loadings", "intercepts")) 
  
  return(fit)
}

```

```{r}

# fit models
bfi_e_fit_constrained    <- constrained_cfa_fit(data = bfi_e_data,    model = bfi_e_model)
bfi_c_fit_constrained    <- constrained_cfa_fit(data = bfi_c_data,    model = bfi_c_model)
bfi_n_fit_constrained    <- constrained_cfa_fit(data = bfi_n_data,    model = bfi_n_model)
bfi_a_fit_constrained    <- constrained_cfa_fit(data = bfi_a_data,    model = bfi_a_model)
bfi_o_fit_constrained    <- constrained_cfa_fit(data = bfi_o_data,    model = bfi_o_model)
bidr_im_fit_constrained  <- constrained_cfa_fit(data = bidr_im_data,  model = bidr_im_model)
bidr_sde_fit_constrained <- constrained_cfa_fit(data = bidr_sde_data, model = bidr_sde_model)
bjw_fit_constrained      <- constrained_cfa_fit(data = bjw_data,      model = bjw_model)
brs_fit_constrained      <- constrained_cfa_fit(data = brs_data,      model = brs_model)
he_fit_constrained       <- constrained_cfa_fit(data = he_data,       model = he_model)
icat_o_fit_constrained   <- constrained_cfa_fit(data = icat_o_data,   model = icat_o_model)
icat_s_fit_constrained   <- constrained_cfa_fit(data = icat_s_data,   model = icat_s_model)
nfc_fit_constrained      <- constrained_cfa_fit(data = nfc_data,      model = nfc_model)
nfcc_p_fit_constrained   <- constrained_cfa_fit(data = nfcc_p_data,   model = nfcc_p_model)
nfcc_d_fit_constrained   <- constrained_cfa_fit(data = nfcc_d_data,   model = nfcc_d_model)
nfcc_c_fit_constrained   <- constrained_cfa_fit(data = nfcc_c_data,   model = nfcc_c_model)
nfcc_a_fit_constrained   <- constrained_cfa_fit(data = nfcc_a_data,   model = nfcc_a_model)
nfcc_o_fit_constrained   <- constrained_cfa_fit(data = nfcc_o_data,   model = nfcc_o_model)
pe_fit_constrained       <- constrained_cfa_fit(data = pe_data,       model = pe_model)
pns_fit_constrained      <- constrained_cfa_fit(data = pns_data,      model = pns_model)
rse_fit_constrained      <- constrained_cfa_fit(data = rse_data,      model = rse_model)
rwa_fit_constrained      <- constrained_cfa_fit(data = rwa_data,      model = rwa_model)
sdo_fit_constrained      <- constrained_cfa_fit(data = sdo_data,      model = sdo_model)
sm_fit_constrained       <- constrained_cfa_fit(data = sm_data,       model = sm_model)
soc_ic_fit_constrained   <- constrained_cfa_fit(data = soc_ic_data,   model = soc_ic_model)
soc_pe_fit_constrained   <- constrained_cfa_fit(data = soc_pe_data,   model = soc_pe_model)


# calculate latent and observed sum scores
constrained_latent_observed_bfi_e <- bfi_e_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_e_fit_constrained))$E) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_e1, bfi_e2, bfi_e3, bfi_e4, bfi_e5, bfi_e6, bfi_e7, bfi_e8))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_bfi_c <- bfi_c_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_c_fit_constrained))$C) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_c1, bfi_c2, bfi_c3, bfi_c4, bfi_c5, bfi_c6, bfi_c7, bfi_c8, bfi_c9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_bfi_n <- bfi_n_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_n_fit_constrained))$N) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_n1, bfi_n2, bfi_n3, bfi_n4, bfi_n5, bfi_n6, bfi_n7, bfi_n8))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_bfi_a <- bfi_a_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_a_fit_constrained))$A) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_a1, bfi_a2, bfi_a3, bfi_a4, bfi_a5, bfi_a6, bfi_a7, bfi_a8, bfi_a9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_bfi_o <- bfi_o_data %>%
  mutate(latent = as.data.frame(lavPredict(bfi_o_fit_constrained))$O) %>%
  rowwise() %>%
  mutate(observed = mean(c(bfi_o1, bfi_o2, bfi_o3, bfi_o4, bfi_o5, bfi_o6, bfi_o7, bfi_o8, bfi_o9, bfi_o10))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_bidr_im <- bidr_im_data %>%
  mutate(latent = as.data.frame(lavPredict(bidr_im_fit_constrained))$IM) %>%
  rowwise() %>%
  mutate(observed = mean(c(bidr_im1, bidr_im2, bidr_im3, bidr_im4, bidr_im5, bidr_im6, bidr_im7, bidr_im8, bidr_im9, bidr_im10, bidr_im11, bidr_im12, bidr_im13, bidr_im14, bidr_im15, bidr_im16, bidr_im17, bidr_im18))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_bidr_sde <- bidr_sde_data %>%
  mutate(latent = as.data.frame(lavPredict(bidr_sde_fit_constrained))$SDE) %>%
  rowwise() %>%
  mutate(observed = mean(c(bidr_sde1, bidr_sde2, bidr_sde3, bidr_sde4, bidr_sde5, bidr_sde6, bidr_sde7, bidr_sde8, bidr_sde9, bidr_sde10, bidr_sde11, bidr_sde12, bidr_sde13, bidr_sde14, bidr_sde15, bidr_sde16, bidr_sde17, bidr_sde18))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_bjw <- bjw_data %>%
  mutate(latent = as.data.frame(lavPredict(bjw_fit_constrained))$BJW) %>%
  rowwise() %>%
  mutate(observed = mean(c(bjw1, bjw2, bjw3, bjw4, bjw5, bjw6))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_brs <- brs_data %>%
  mutate(latent = as.data.frame(lavPredict(brs_fit_constrained))$BRS) %>%
  rowwise() %>%
  mutate(observed = mean(c(brs1, brs2, brs3, brs4, brs5, brs6, brs7, brs8, brs9, brs10, brs11, brs12, brs13, brs14, brs15, brs16))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_he <- he_data %>%
  mutate(latent = as.data.frame(lavPredict(he_fit_constrained))$HE) %>%
  rowwise() %>%
  mutate(observed = mean(c(he1, he2, he3, he4, he5, he6, he7, he8, he9, he10))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_icat_o <- icat_o_data %>%
  mutate(latent = as.data.frame(lavPredict(icat_o_fit_constrained))$ICAT_O) %>%
  rowwise() %>%
  mutate(observed = mean(c(icat_o1, icat_o2, icat_o3, icat_o4, icat_o5, icat_o6, icat_o7, icat_o8, icat_o9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_icat_s <- icat_s_data %>%
  mutate(latent = as.data.frame(lavPredict(icat_s_fit_constrained))$ICAT_S) %>%
  rowwise() %>%
  mutate(observed = mean(c(icat_s1, icat_s2, icat_s3, icat_s4, icat_s5, icat_s6, icat_s7, icat_s8, icat_s9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_nfc <- nfc_data %>%
  mutate(latent = as.data.frame(lavPredict(nfc_fit_constrained))$NFC) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfc1, nfc2, nfc3, nfc4, nfc5, nfc6, nfc7, nfc8, nfc9, nfc10, nfc11, nfc12, nfc13, nfc14, nfc15, nfc16, nfc17, nfc18))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_nfcc_p <- nfcc_p_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_p_fit_constrained))$P) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_p1, nfcc_p2, nfcc_p3, nfcc_p4, nfcc_p5, nfcc_p6, nfcc_p7, nfcc_p8))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_nfcc_d <- nfcc_d_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_d_fit_constrained))$D) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_d1, nfcc_d2, nfcc_d3, nfcc_d4, nfcc_d5, nfcc_d6, nfcc_d7))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_nfcc_c <- nfcc_c_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_c_fit_constrained))$C) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_c1, nfcc_c2, nfcc_c3, nfcc_c4, nfcc_c5, nfcc_c6, nfcc_c7, nfcc_c8))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_nfcc_a <- nfcc_a_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_a_fit_constrained))$A) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_a1, nfcc_a2, nfcc_a3, nfcc_a4, nfcc_a5, nfcc_a6, nfcc_a7, nfcc_a8))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_nfcc_o <- nfcc_o_data %>%
  mutate(latent = as.data.frame(lavPredict(nfcc_o_fit_constrained))$O) %>%
  rowwise() %>%
  mutate(observed = mean(c(nfcc_o1, nfcc_o2, nfcc_o3, nfcc_o4, nfcc_o5, nfcc_o6, nfcc_o7))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_pe <- pe_data %>%
  mutate(latent = as.data.frame(lavPredict(pe_fit_constrained))$PE) %>%
  rowwise() %>%
  mutate(observed = mean(c(pe1, pe2, pe3, pe4, pe5, pe6, pe7, pe8, pe9, pe10, pe11))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_pns <- pns_data %>%
  mutate(latent = as.data.frame(lavPredict(pns_fit_constrained))$PNS) %>%
  rowwise() %>%
  mutate(observed = mean(c(pns1, pns2, pns3, pns4, pns5, pns6, pns7, pns8, pns9, pns10, pns11, pns12))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_rse <- rse_data %>%
  mutate(latent = as.data.frame(lavPredict(rse_fit_constrained))$RSE) %>%
  rowwise() %>%
  mutate(observed = mean(c(rse1, rse2, rse3, rse4, rse5, rse6, rse7, rse8, rse9, rse10))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_rwa <- rwa_data %>%
  mutate(latent = as.data.frame(lavPredict(rwa_fit_constrained))$RWA) %>%
  rowwise() %>%
  mutate(observed = mean(c(rwa1, rwa2, rwa3, rwa4, rwa5, rwa6, rwa7, rwa8, rwa9, rwa10, rwa11, rwa12, rwa13, rwa14, rwa15, rwa16, rwa17, rwa18, rwa19, rwa20))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_sdo <- sdo_data %>%
  mutate(latent = as.data.frame(lavPredict(sdo_fit_constrained))$SDO) %>%
  rowwise() %>%
  mutate(observed = mean(c(sdo1, sdo2, sdo3, sdo4, sdo5, sdo6, sdo7, sdo8, sdo9, sdo10, sdo11, sdo12))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_sm <- sm_data %>%
  mutate(latent = as.data.frame(lavPredict(sm_fit_constrained))$SM) %>%
  rowwise() %>%
  mutate(observed = mean(c(sm1, sm2, sm3, sm4, sm5, sm6, sm7, sm8, sm9, sm10, sm11, sm12, sm13, sm14, sm15, sm16, sm17, sm18))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_soc_ic <- soc_ic_data %>%
  mutate(latent = as.data.frame(lavPredict(soc_ic_fit_constrained))$IC) %>%
  rowwise() %>%
  mutate(observed = mean(c(soc_ic1, soc_ic2, soc_ic3, soc_ic4, soc_ic5, soc_ic6, soc_ic7, soc_ic8, soc_ic9))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

constrained_latent_observed_soc_pe <- soc_pe_data %>%
  mutate(latent = as.data.frame(lavPredict(soc_pe_fit_constrained))$PE) %>%
  rowwise() %>%
  mutate(observed = mean(c(soc_pe1, soc_pe2, soc_pe3, soc_pe4, soc_pe5, soc_pe6, soc_pe7, soc_pe8, soc_pe9, soc_pe10))) %>%
  ungroup() %>%
  select(age, sex, 
         latent, observed)

```

## Between-group differences on the latent vs. the observed scales.

```{r}
  
es_constrained_latent_sex_bfi_e      <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_bfi_e)
es_constrained_latent_sex_bfi_c      <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_bfi_c)
es_constrained_latent_sex_bfi_n      <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_bfi_n)
es_constrained_latent_sex_bfi_a      <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_bfi_a)
es_constrained_latent_sex_bfi_o      <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_bfi_o)
es_constrained_latent_sex_bidr_im    <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_bidr_im)
es_constrained_latent_sex_bidr_sde   <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_bidr_sde)
es_constrained_latent_sex_bjw        <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_bjw)
es_constrained_latent_sex_brs        <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_brs)
es_constrained_latent_sex_he         <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_he)
es_constrained_latent_sex_icat_o     <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_icat_o)
es_constrained_latent_sex_icat_s     <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_icat_s)
es_constrained_latent_sex_nfc        <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_nfc)
es_constrained_latent_sex_nfcc_p     <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_nfcc_p)
es_constrained_latent_sex_nfcc_d     <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_nfcc_d)
es_constrained_latent_sex_nfcc_c     <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_nfcc_c)
es_constrained_latent_sex_nfcc_a     <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_nfcc_a)
es_constrained_latent_sex_nfcc_o     <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_nfcc_o)
es_constrained_latent_sex_pe         <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_pe)
es_constrained_latent_sex_pns        <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_pns)
es_constrained_latent_sex_rse        <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_rse)
es_constrained_latent_sex_rwa        <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_rwa)
es_constrained_latent_sex_sdo        <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_sdo)
es_constrained_latent_sex_sm         <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_sm)
es_constrained_latent_sex_soc_ic     <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_soc_ic)
es_constrained_latent_sex_soc_pe     <- effsize::cohen.d(latent ~ sex,     data = constrained_latent_observed_soc_pe)

es_constrained_latent_age_bfi_e      <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_bfi_e)
es_constrained_latent_age_bfi_c      <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_bfi_c)
es_constrained_latent_age_bfi_n      <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_bfi_n)
es_constrained_latent_age_bfi_a      <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_bfi_a)
es_constrained_latent_age_bfi_o      <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_bfi_o)
es_constrained_latent_age_bidr_im    <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_bidr_im)
es_constrained_latent_age_bidr_sde   <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_bidr_sde)
es_constrained_latent_age_bjw        <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_bjw)
es_constrained_latent_age_brs        <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_brs)
es_constrained_latent_age_he         <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_he)
es_constrained_latent_age_icat_o     <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_icat_o)
es_constrained_latent_age_icat_s     <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_icat_s)
es_constrained_latent_age_nfc        <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_nfc)
es_constrained_latent_age_nfcc_p     <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_nfcc_p)
es_constrained_latent_age_nfcc_d     <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_nfcc_d)
es_constrained_latent_age_nfcc_c     <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_nfcc_c)
es_constrained_latent_age_nfcc_a     <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_nfcc_a)
es_constrained_latent_age_nfcc_o     <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_nfcc_o)
es_constrained_latent_age_pe         <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_pe)
es_constrained_latent_age_pns        <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_pns)
es_constrained_latent_age_rse        <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_rse)
es_constrained_latent_age_rwa        <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_rwa)
es_constrained_latent_age_sdo        <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_sdo)
es_constrained_latent_age_sm         <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_sm)
es_constrained_latent_age_soc_ic     <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_soc_ic)
es_constrained_latent_age_soc_pe     <- effsize::cohen.d(latent ~ age,     data = constrained_latent_observed_soc_pe)

es_constrained_observed_sex_bfi_e    <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_bfi_e)
es_constrained_observed_sex_bfi_c    <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_bfi_c)
es_constrained_observed_sex_bfi_n    <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_bfi_n)
es_constrained_observed_sex_bfi_a    <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_bfi_a)
es_constrained_observed_sex_bfi_o    <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_bfi_o)
es_constrained_observed_sex_bidr_im  <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_bidr_im)
es_constrained_observed_sex_bidr_sde <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_bidr_sde)
es_constrained_observed_sex_bjw      <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_bjw)
es_constrained_observed_sex_brs      <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_brs)
es_constrained_observed_sex_he       <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_he)
es_constrained_observed_sex_icat_o   <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_icat_o)
es_constrained_observed_sex_icat_s   <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_icat_s)
es_constrained_observed_sex_nfc      <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_nfc)
es_constrained_observed_sex_nfcc_p   <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_nfcc_p)
es_constrained_observed_sex_nfcc_d   <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_nfcc_d)
es_constrained_observed_sex_nfcc_c   <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_nfcc_c)
es_constrained_observed_sex_nfcc_a   <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_nfcc_a)
es_constrained_observed_sex_nfcc_o   <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_nfcc_o)
es_constrained_observed_sex_pe       <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_pe)
es_constrained_observed_sex_pns      <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_pns)
es_constrained_observed_sex_rse      <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_rse)
es_constrained_observed_sex_rwa      <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_rwa)
es_constrained_observed_sex_sdo      <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_sdo)
es_constrained_observed_sex_sm       <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_sm)
es_constrained_observed_sex_soc_ic   <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_soc_ic)
es_constrained_observed_sex_soc_pe   <- effsize::cohen.d(observed ~ sex,   data = constrained_latent_observed_soc_pe)

es_constrained_observed_age_bfi_e    <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_bfi_e)
es_constrained_observed_age_bfi_c    <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_bfi_c)
es_constrained_observed_age_bfi_n    <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_bfi_n)
es_constrained_observed_age_bfi_a    <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_bfi_a)
es_constrained_observed_age_bfi_o    <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_bfi_o)
es_constrained_observed_age_bidr_im  <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_bidr_im)
es_constrained_observed_age_bidr_sde <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_bidr_sde)
es_constrained_observed_age_bjw      <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_bjw)
es_constrained_observed_age_brs      <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_brs)
es_constrained_observed_age_he       <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_he)
es_constrained_observed_age_icat_o   <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_icat_o)
es_constrained_observed_age_icat_s   <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_icat_s)
es_constrained_observed_age_nfc      <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_nfc)
es_constrained_observed_age_nfcc_p   <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_nfcc_p)
es_constrained_observed_age_nfcc_d   <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_nfcc_d)
es_constrained_observed_age_nfcc_c   <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_nfcc_c)
es_constrained_observed_age_nfcc_a   <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_nfcc_a)
es_constrained_observed_age_nfcc_o   <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_nfcc_o)
es_constrained_observed_age_pe       <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_pe)
es_constrained_observed_age_pns      <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_pns)
es_constrained_observed_age_rse      <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_rse)
es_constrained_observed_age_rwa      <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_rwa)
es_constrained_observed_age_sdo      <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_sdo)
es_constrained_observed_age_sm       <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_sm)
es_constrained_observed_age_soc_ic   <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_soc_ic)
es_constrained_observed_age_soc_pe   <- effsize::cohen.d(observed ~ age,   data = constrained_latent_observed_soc_pe)
  

group_differences_results <- 
  data.frame(scale_name = c("bfi_a", "bfi_c", "bfi_e", "bfi_n", "bfi_o", "bidr_im", "bidr_sde", "bjw", "brs", "he", "icat_o", "icat_s", "nfc", "nfcc_p", "nfcc_d", "nfcc_c", "nfcc_a", "nfcc_o", "pe", "pns", "rse", "rwa", "sdo", "sm", "soc_ic", "soc_pe"),
             group_comparison = c("age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "age", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex", "sex"),
             latent_cohens_d = c(es_constrained_latent_age_bfi_a$estimate,
                                 es_constrained_latent_age_bfi_c$estimate,
                                 es_constrained_latent_age_bfi_e$estimate,
                                 es_constrained_latent_age_bfi_n$estimate,
                                 es_constrained_latent_age_bfi_o$estimate,
                                 es_constrained_latent_age_bidr_im$estimate,
                                 es_constrained_latent_age_bidr_sde$estimate,
                                 es_constrained_latent_age_bjw$estimate,
                                 es_constrained_latent_age_brs$estimate,
                                 es_constrained_latent_age_he$estimate,
                                 es_constrained_latent_age_icat_o$estimate,
                                 es_constrained_latent_age_icat_s$estimate,
                                 es_constrained_latent_age_nfc$estimate,
                                 es_constrained_latent_age_nfcc_p$estimate,
                                 es_constrained_latent_age_nfcc_d$estimate,
                                 es_constrained_latent_age_nfcc_c$estimate,
                                 es_constrained_latent_age_nfcc_a$estimate,
                                 es_constrained_latent_age_nfcc_o$estimate,
                                 es_constrained_latent_age_pe$estimate,
                                 es_constrained_latent_age_pns$estimate,
                                 es_constrained_latent_age_rse$estimate,
                                 es_constrained_latent_age_rwa$estimate,
                                 es_constrained_latent_age_sdo$estimate,
                                 es_constrained_latent_age_sm$estimate,
                                 es_constrained_latent_age_soc_ic$estimate,
                                 es_constrained_latent_age_soc_pe$estimate,
                                 es_constrained_latent_sex_bfi_a$estimate,
                                 es_constrained_latent_sex_bfi_c$estimate,
                                 es_constrained_latent_sex_bfi_e$estimate,
                                 es_constrained_latent_sex_bfi_n$estimate,
                                 es_constrained_latent_sex_bfi_o$estimate,
                                 es_constrained_latent_sex_bidr_im$estimate,
                                 es_constrained_latent_sex_bidr_sde$estimate,
                                 es_constrained_latent_sex_bjw$estimate,
                                 es_constrained_latent_sex_brs$estimate,
                                 es_constrained_latent_sex_he$estimate,
                                 es_constrained_latent_sex_icat_o$estimate,
                                 es_constrained_latent_sex_icat_s$estimate,
                                 es_constrained_latent_sex_nfc$estimate,
                                 es_constrained_latent_sex_nfcc_p$estimate,
                                 es_constrained_latent_sex_nfcc_d$estimate,
                                 es_constrained_latent_sex_nfcc_c$estimate,
                                 es_constrained_latent_sex_nfcc_a$estimate,
                                 es_constrained_latent_sex_nfcc_o$estimate,
                                 es_constrained_latent_sex_pe$estimate,
                                 es_constrained_latent_sex_pns$estimate,
                                 es_constrained_latent_sex_rse$estimate,
                                 es_constrained_latent_sex_rwa$estimate,
                                 es_constrained_latent_sex_sdo$estimate,
                                 es_constrained_latent_sex_sm$estimate,
                                 es_constrained_latent_sex_soc_ic$estimate,
                                 es_constrained_latent_sex_soc_pe$estimate),
             latent_cohens_d_ci_lwr = c(es_constrained_latent_age_bfi_a$conf.int[1],
                                        es_constrained_latent_age_bfi_c$conf.int[1],
                                        es_constrained_latent_age_bfi_e$conf.int[1],
                                        es_constrained_latent_age_bfi_n$conf.int[1],
                                        es_constrained_latent_age_bfi_o$conf.int[1],
                                        es_constrained_latent_age_bidr_im$conf.int[1],
                                        es_constrained_latent_age_bidr_sde$conf.int[1],
                                        es_constrained_latent_age_bjw$conf.int[1],
                                        es_constrained_latent_age_brs$conf.int[1],
                                        es_constrained_latent_age_he$conf.int[1],
                                        es_constrained_latent_age_icat_o$conf.int[1],
                                        es_constrained_latent_age_icat_s$conf.int[1],
                                        es_constrained_latent_age_nfc$conf.int[1],
                                        es_constrained_latent_age_nfcc_p$conf.int[1],
                                        es_constrained_latent_age_nfcc_d$conf.int[1],
                                        es_constrained_latent_age_nfcc_c$conf.int[1],
                                        es_constrained_latent_age_nfcc_a$conf.int[1],
                                        es_constrained_latent_age_nfcc_o$conf.int[1],
                                        es_constrained_latent_age_pe$conf.int[1],
                                        es_constrained_latent_age_pns$conf.int[1],
                                        es_constrained_latent_age_rse$conf.int[1],
                                        es_constrained_latent_age_rwa$conf.int[1],
                                        es_constrained_latent_age_sdo$conf.int[1],
                                        es_constrained_latent_age_sm$conf.int[1],
                                        es_constrained_latent_age_soc_ic$conf.int[1],
                                        es_constrained_latent_age_soc_pe$conf.int[1],
                                        es_constrained_latent_sex_bfi_a$conf.int[1],
                                        es_constrained_latent_sex_bfi_c$conf.int[1],
                                        es_constrained_latent_sex_bfi_e$conf.int[1],
                                        es_constrained_latent_sex_bfi_n$conf.int[1],
                                        es_constrained_latent_sex_bfi_o$conf.int[1],
                                        es_constrained_latent_sex_bidr_im$conf.int[1],
                                        es_constrained_latent_sex_bidr_sde$conf.int[1],
                                        es_constrained_latent_sex_bjw$conf.int[1],
                                        es_constrained_latent_sex_brs$conf.int[1],
                                        es_constrained_latent_sex_he$conf.int[1],
                                        es_constrained_latent_sex_icat_o$conf.int[1],
                                        es_constrained_latent_sex_icat_s$conf.int[1],
                                        es_constrained_latent_sex_nfc$conf.int[1],
                                        es_constrained_latent_sex_nfcc_p$conf.int[1],
                                        es_constrained_latent_sex_nfcc_d$conf.int[1],
                                        es_constrained_latent_sex_nfcc_c$conf.int[1],
                                        es_constrained_latent_sex_nfcc_a$conf.int[1],
                                        es_constrained_latent_sex_nfcc_o$conf.int[1],
                                        es_constrained_latent_sex_pe$conf.int[1],
                                        es_constrained_latent_sex_pns$conf.int[1],
                                        es_constrained_latent_sex_rse$conf.int[1],
                                        es_constrained_latent_sex_rwa$conf.int[1],
                                        es_constrained_latent_sex_sdo$conf.int[1],
                                        es_constrained_latent_sex_sm$conf.int[1],
                                        es_constrained_latent_sex_soc_ic$conf.int[1],
                                        es_constrained_latent_sex_soc_pe$conf.int[1]),
             latent_cohens_d_ci_upr = c(es_constrained_latent_age_bfi_a$conf.int[2],
                                        es_constrained_latent_age_bfi_c$conf.int[2],
                                        es_constrained_latent_age_bfi_e$conf.int[2],
                                        es_constrained_latent_age_bfi_n$conf.int[2],
                                        es_constrained_latent_age_bfi_o$conf.int[2],
                                        es_constrained_latent_age_bidr_im$conf.int[2],
                                        es_constrained_latent_age_bidr_sde$conf.int[2],
                                        es_constrained_latent_age_bjw$conf.int[2],
                                        es_constrained_latent_age_brs$conf.int[2],
                                        es_constrained_latent_age_he$conf.int[2],
                                        es_constrained_latent_age_icat_o$conf.int[2],
                                        es_constrained_latent_age_icat_s$conf.int[2],
                                        es_constrained_latent_age_nfc$conf.int[2],
                                        es_constrained_latent_age_nfcc_p$conf.int[2],
                                        es_constrained_latent_age_nfcc_d$conf.int[2],
                                        es_constrained_latent_age_nfcc_c$conf.int[2],
                                        es_constrained_latent_age_nfcc_a$conf.int[2],
                                        es_constrained_latent_age_nfcc_o$conf.int[2],
                                        es_constrained_latent_age_pe$conf.int[2],
                                        es_constrained_latent_age_pns$conf.int[2],
                                        es_constrained_latent_age_rse$conf.int[2],
                                        es_constrained_latent_age_rwa$conf.int[2],
                                        es_constrained_latent_age_sdo$conf.int[2],
                                        es_constrained_latent_age_sm$conf.int[2],
                                        es_constrained_latent_age_soc_ic$conf.int[2],
                                        es_constrained_latent_age_soc_pe$conf.int[2],
                                        es_constrained_latent_sex_bfi_a$conf.int[2],
                                        es_constrained_latent_sex_bfi_c$conf.int[2],
                                        es_constrained_latent_sex_bfi_e$conf.int[2],
                                        es_constrained_latent_sex_bfi_n$conf.int[2],
                                        es_constrained_latent_sex_bfi_o$conf.int[2],
                                        es_constrained_latent_sex_bidr_im$conf.int[2],
                                        es_constrained_latent_sex_bidr_sde$conf.int[2],
                                        es_constrained_latent_sex_bjw$conf.int[2],
                                        es_constrained_latent_sex_brs$conf.int[2],
                                        es_constrained_latent_sex_he$conf.int[2],
                                        es_constrained_latent_sex_icat_o$conf.int[2],
                                        es_constrained_latent_sex_icat_s$conf.int[2],
                                        es_constrained_latent_sex_nfc$conf.int[2],
                                        es_constrained_latent_sex_nfcc_p$conf.int[2],
                                        es_constrained_latent_sex_nfcc_d$conf.int[2],
                                        es_constrained_latent_sex_nfcc_c$conf.int[2],
                                        es_constrained_latent_sex_nfcc_a$conf.int[2],
                                        es_constrained_latent_sex_nfcc_o$conf.int[2],
                                        es_constrained_latent_sex_pe$conf.int[2],
                                        es_constrained_latent_sex_pns$conf.int[2],
                                        es_constrained_latent_sex_rse$conf.int[2],
                                        es_constrained_latent_sex_rwa$conf.int[2],
                                        es_constrained_latent_sex_sdo$conf.int[2],
                                        es_constrained_latent_sex_sm$conf.int[2],
                                        es_constrained_latent_sex_soc_ic$conf.int[2],
                                        es_constrained_latent_sex_soc_pe$conf.int[2]),
             observed_cohens_d = c(es_constrained_observed_age_bfi_a$estimate,
                                   es_constrained_observed_age_bfi_c$estimate,
                                   es_constrained_observed_age_bfi_e$estimate,
                                   es_constrained_observed_age_bfi_n$estimate,
                                   es_constrained_observed_age_bfi_o$estimate,
                                   es_constrained_observed_age_bidr_im$estimate,
                                   es_constrained_observed_age_bidr_sde$estimate,
                                   es_constrained_observed_age_bjw$estimate,
                                   es_constrained_observed_age_brs$estimate,
                                   es_constrained_observed_age_he$estimate,
                                   es_constrained_observed_age_icat_o$estimate,
                                   es_constrained_observed_age_icat_s$estimate,
                                   es_constrained_observed_age_nfc$estimate,
                                   es_constrained_observed_age_nfcc_p$estimate,
                                   es_constrained_observed_age_nfcc_d$estimate,
                                   es_constrained_observed_age_nfcc_c$estimate,
                                   es_constrained_observed_age_nfcc_a$estimate,
                                   es_constrained_observed_age_nfcc_o$estimate,
                                   es_constrained_observed_age_pe$estimate,
                                   es_constrained_observed_age_pns$estimate,
                                   es_constrained_observed_age_rse$estimate,
                                   es_constrained_observed_age_rwa$estimate,
                                   es_constrained_observed_age_sdo$estimate,
                                   es_constrained_observed_age_sm$estimate,
                                   es_constrained_observed_age_soc_ic$estimate,
                                   es_constrained_observed_age_soc_pe$estimate,
                                   es_constrained_observed_sex_bfi_a$estimate,
                                   es_constrained_observed_sex_bfi_c$estimate,
                                   es_constrained_observed_sex_bfi_e$estimate,
                                   es_constrained_observed_sex_bfi_n$estimate,
                                   es_constrained_observed_sex_bfi_o$estimate,
                                   es_constrained_observed_sex_bidr_im$estimate,
                                   es_constrained_observed_sex_bidr_sde$estimate,
                                   es_constrained_observed_sex_bjw$estimate,
                                   es_constrained_observed_sex_brs$estimate,
                                   es_constrained_observed_sex_he$estimate,
                                   es_constrained_observed_sex_icat_o$estimate,
                                   es_constrained_observed_sex_icat_s$estimate,
                                   es_constrained_observed_sex_nfc$estimate,
                                   es_constrained_observed_sex_nfcc_p$estimate,
                                   es_constrained_observed_sex_nfcc_d$estimate,
                                   es_constrained_observed_sex_nfcc_c$estimate,
                                   es_constrained_observed_sex_nfcc_a$estimate,
                                   es_constrained_observed_sex_nfcc_o$estimate,
                                   es_constrained_observed_sex_pe$estimate,
                                   es_constrained_observed_sex_pns$estimate,
                                   es_constrained_observed_sex_rse$estimate,
                                   es_constrained_observed_sex_rwa$estimate,
                                   es_constrained_observed_sex_sdo$estimate,
                                   es_constrained_observed_sex_sm$estimate,
                                   es_constrained_observed_sex_soc_ic$estimate,
                                   es_constrained_observed_sex_soc_pe$estimate),
             observed_cohens_d_ci_lwr = c(es_constrained_observed_age_bfi_a$conf.int[1],
                                          es_constrained_observed_age_bfi_c$conf.int[1],
                                          es_constrained_observed_age_bfi_e$conf.int[1],
                                          es_constrained_observed_age_bfi_n$conf.int[1],
                                          es_constrained_observed_age_bfi_o$conf.int[1],
                                          es_constrained_observed_age_bidr_im$conf.int[1],
                                          es_constrained_observed_age_bidr_sde$conf.int[1],
                                          es_constrained_observed_age_bjw$conf.int[1],
                                          es_constrained_observed_age_brs$conf.int[1],
                                          es_constrained_observed_age_he$conf.int[1],
                                          es_constrained_observed_age_icat_o$conf.int[1],
                                          es_constrained_observed_age_icat_s$conf.int[1],
                                          es_constrained_observed_age_nfc$conf.int[1],
                                          es_constrained_observed_age_nfcc_p$conf.int[1],
                                          es_constrained_observed_age_nfcc_d$conf.int[1],
                                          es_constrained_observed_age_nfcc_c$conf.int[1],
                                          es_constrained_observed_age_nfcc_a$conf.int[1],
                                          es_constrained_observed_age_nfcc_o$conf.int[1],
                                          es_constrained_observed_age_pe$conf.int[1],
                                          es_constrained_observed_age_pns$conf.int[1],
                                          es_constrained_observed_age_rse$conf.int[1],
                                          es_constrained_observed_age_rwa$conf.int[1],
                                          es_constrained_observed_age_sdo$conf.int[1],
                                          es_constrained_observed_age_sm$conf.int[1],
                                          es_constrained_observed_age_soc_ic$conf.int[1],
                                          es_constrained_observed_age_soc_pe$conf.int[1],
                                          es_constrained_observed_sex_bfi_a$conf.int[1],
                                          es_constrained_observed_sex_bfi_c$conf.int[1],
                                          es_constrained_observed_sex_bfi_e$conf.int[1],
                                          es_constrained_observed_sex_bfi_n$conf.int[1],
                                          es_constrained_observed_sex_bfi_o$conf.int[1],
                                          es_constrained_observed_sex_bidr_im$conf.int[1],
                                          es_constrained_observed_sex_bidr_sde$conf.int[1],
                                          es_constrained_observed_sex_bjw$conf.int[1],
                                          es_constrained_observed_sex_brs$conf.int[1],
                                          es_constrained_observed_sex_he$conf.int[1],
                                          es_constrained_observed_sex_icat_o$conf.int[1],
                                          es_constrained_observed_sex_icat_s$conf.int[1],
                                          es_constrained_observed_sex_nfc$conf.int[1],
                                          es_constrained_observed_sex_nfcc_p$conf.int[1],
                                          es_constrained_observed_sex_nfcc_d$conf.int[1],
                                          es_constrained_observed_sex_nfcc_c$conf.int[1],
                                          es_constrained_observed_sex_nfcc_a$conf.int[1],
                                          es_constrained_observed_sex_nfcc_o$conf.int[1],
                                          es_constrained_observed_sex_pe$conf.int[1],
                                          es_constrained_observed_sex_pns$conf.int[1],
                                          es_constrained_observed_sex_rse$conf.int[1],
                                          es_constrained_observed_sex_rwa$conf.int[1],
                                          es_constrained_observed_sex_sdo$conf.int[1],
                                          es_constrained_observed_sex_sm$conf.int[1],
                                          es_constrained_observed_sex_soc_ic$conf.int[1],
                                          es_constrained_observed_sex_soc_pe$conf.int[1]),
             observed_cohens_d_ci_upr = c(es_constrained_observed_age_bfi_a$conf.int[2],
                                          es_constrained_observed_age_bfi_c$conf.int[2],
                                          es_constrained_observed_age_bfi_e$conf.int[2],
                                          es_constrained_observed_age_bfi_n$conf.int[2],
                                          es_constrained_observed_age_bfi_o$conf.int[2],
                                          es_constrained_observed_age_bidr_im$conf.int[2],
                                          es_constrained_observed_age_bidr_sde$conf.int[2],
                                          es_constrained_observed_age_bjw$conf.int[2],
                                          es_constrained_observed_age_brs$conf.int[2],
                                          es_constrained_observed_age_he$conf.int[2],
                                          es_constrained_observed_age_icat_o$conf.int[2],
                                          es_constrained_observed_age_icat_s$conf.int[2],
                                          es_constrained_observed_age_nfc$conf.int[2],
                                          es_constrained_observed_age_nfcc_p$conf.int[2],
                                          es_constrained_observed_age_nfcc_d$conf.int[2],
                                          es_constrained_observed_age_nfcc_c$conf.int[2],
                                          es_constrained_observed_age_nfcc_a$conf.int[2],
                                          es_constrained_observed_age_nfcc_o$conf.int[2],
                                          es_constrained_observed_age_pe$conf.int[2],
                                          es_constrained_observed_age_pns$conf.int[2],
                                          es_constrained_observed_age_rse$conf.int[2],
                                          es_constrained_observed_age_rwa$conf.int[2],
                                          es_constrained_observed_age_sdo$conf.int[2],
                                          es_constrained_observed_age_sm$conf.int[2],
                                          es_constrained_observed_age_soc_ic$conf.int[2],
                                          es_constrained_observed_age_soc_pe$conf.int[2],
                                          es_constrained_observed_sex_bfi_a$conf.int[2],
                                          es_constrained_observed_sex_bfi_c$conf.int[2],
                                          es_constrained_observed_sex_bfi_e$conf.int[2],
                                          es_constrained_observed_sex_bfi_n$conf.int[2],
                                          es_constrained_observed_sex_bfi_o$conf.int[2],
                                          es_constrained_observed_sex_bidr_im$conf.int[2],
                                          es_constrained_observed_sex_bidr_sde$conf.int[2],
                                          es_constrained_observed_sex_bjw$conf.int[2],
                                          es_constrained_observed_sex_brs$conf.int[2],
                                          es_constrained_observed_sex_he$conf.int[2],
                                          es_constrained_observed_sex_icat_o$conf.int[2],
                                          es_constrained_observed_sex_icat_s$conf.int[2],
                                          es_constrained_observed_sex_nfc$conf.int[2],
                                          es_constrained_observed_sex_nfcc_p$conf.int[2],
                                          es_constrained_observed_sex_nfcc_d$conf.int[2],
                                          es_constrained_observed_sex_nfcc_c$conf.int[2],
                                          es_constrained_observed_sex_nfcc_a$conf.int[2],
                                          es_constrained_observed_sex_nfcc_o$conf.int[2],
                                          es_constrained_observed_sex_pe$conf.int[2],
                                          es_constrained_observed_sex_pns$conf.int[2],
                                          es_constrained_observed_sex_rse$conf.int[2],
                                          es_constrained_observed_sex_rwa$conf.int[2],
                                          es_constrained_observed_sex_sdo$conf.int[2],
                                          es_constrained_observed_sex_sm$conf.int[2],
                                          es_constrained_observed_sex_soc_ic$conf.int[2],
                                          es_constrained_observed_sex_soc_pe$conf.int[2])) %>%
  mutate(observed_latent_cohens_d_diff = observed_cohens_d - latent_cohens_d,
         abs_observed_latent_cohens_d_diff = abs(observed_latent_cohens_d_diff),
         sig_change = ifelse((latent_cohens_d > observed_cohens_d_ci_lwr & 
                                latent_cohens_d > observed_cohens_d_ci_upr & 
                                observed_cohens_d < latent_cohens_d_ci_lwr & 
                                observed_cohens_d < latent_cohens_d_ci_upr) |
                               (latent_cohens_d < observed_cohens_d_ci_lwr & 
                                latent_cohens_d < observed_cohens_d_ci_upr & 
                                observed_cohens_d > latent_cohens_d_ci_lwr & 
                                observed_cohens_d > latent_cohens_d_ci_upr), TRUE, FALSE)) %>%
  round_df(3) %>%
  mutate(Scale = dplyr::recode(scale_name,
                               "bfi_e"    = "Big 5 Inventory - E",
                               "bfi_c"    = "Big 5 Inventory - C",
                               "bfi_n"    = "Big 5 Inventory - N",
                               "bfi_a"    = "Big 5 Inventory - A",
                               "bfi_o"    = "Big 5 Inventory - O",
                               "bidr_im"  = "Balanced Inventory of Desirable Responding - Impression Management",
                               "bidr_sde" = "Balanced Inventory of Desirable Responding - Self Deception",
                               "bjw"      = "Belief in a Just World: General Just World Scale",
                               "brs"      = "Bayesian Racism",
                               "he"       = "Humanitarianism-Egalitarianism",
                               "icat_o"   = "Intuitions about Controllability and Awareness of Thoughts - Others",
                               "icat_s"   = "Intuitions about Controllability and Awareness of Thoughts - Self",
                               "nfc"      = "Need for Cognition",
                               "nfcc_p"   = "Need for Cognitive Closure - P",
                               "nfcc_d"   = "Need for Cognitive Closure - D",
                               "nfcc_c"   = "Need for Cognitive Closure - C",
                               "nfcc_a"   = "Need for Cognitive Closure - A",
                               "nfcc_o"   = "Need for Cognitive Closure - O",
                               "pe"       = "Protestant Ethic",
                               "pns"      = "Personal Need for Structure",
                               "rse"      = "Rosenberg Self-Esteem",
                               "rwa"      = "Ring-Wing Authoritarianism",
                               "sdo"      = "Social Dominance Orientation",
                               "sm"       = "Self-Monitoring",
                               "soc_ic"   = "Spheres of Control - Interpersonal Control",
                               "soc_pe"   = "Spheres of Control - Personal Efficacy")) %>%
  select(-scale_name) %>%
  arrange(Scale)

# write to disk
write_csv(group_differences_results, "results/supplementary_results_effect_sizes_measurement_invariance.csv")

# summarize
summary <- group_differences_results %>%
  select(Scale,
         group_comparison,
         observed_cohens_d,
         latent_cohens_d,
         abs_observed_latent_cohens_d_diff,
         sig_change)

summary %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)

```

```{r fig.height=12, fig.width=7}

p1 <- ggplot(summary, aes(observed_cohens_d, latent_cohens_d, color = sig_change)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "darkgrey") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "darkgrey") +
  geom_abline(slope = 1) +
  geom_point() +
  scale_color_viridis_d(begin = 0.3, end = 0.7)

p2 <- ggplot(summary, aes(abs_observed_latent_cohens_d_diff, fill = "dummy")) +
  geom_density(alpha = 0.7) +
  scale_fill_viridis_d(begin = 0.7, end = 0.7) + 
  theme(legend.position = "none")  

p1 / p2

```

`r round(mean(summary$sig_change)*100, 1)`% of MI tests showed a significant change in effect size between the latent and observed scores.


